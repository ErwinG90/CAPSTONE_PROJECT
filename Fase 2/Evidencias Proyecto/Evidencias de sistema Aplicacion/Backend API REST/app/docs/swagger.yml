openapi: 3.0.4
info:
  title: RutaFit API
  description: API para usuarios, eventos, tipos de deporte y niveles (sin autenticación).
  version: 1.0.0

servers:
  - url: http://localhost:3000/ms-rutafit-neg
    description: Local
  - url: https://capstone-project-3-13xo.onrender.com/ms-rutafit-neg
    description: Producción (Render)

tags:
  - name: usuarios
    description: Gestión básica de usuarios
  - name: deportes
    description: Catálogo de tipos de deporte
  - name: niveles
    description: Catálogo de niveles de experiencia
  - name: eventos
    description: Gestión de eventos y participación

paths:
  # ------------------ USUARIOS ------------------
  /users:
    get:
      tags: [usuarios]
      summary: Traer todos los usuarios
      responses:
        "200":
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Usuario" }
              examples:
                ejemplo:
                  value:
                    - _id: "oG2iP81bPadEch2c9mPiwejAsTr1"
                      nombre: "Merlu Cindy"
                      apellido: "Beyer Ulloa"
                      email: "ci.beyer@duocuc.cl"
                      fechaNacimiento: "2025-10-10"
                      genero: "mujer"
                      deporteFavorito: "68db058ff227b0dedcbcafec"
                      nivelExperiencia: "68db0d46f227b0dedcbcafff"
                      fechaRegistro: "2025-10-11T05:12:03.787Z"
                      rutas: []
                      eventos: ["68f1796608971e9b32658691"]
    post:
      tags: [usuarios]
      summary: Guardar usuario
      description: Crea un usuario. **No** se envían `_id`, `fechaRegistro` ni campos de sistema.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UsuarioCreateInput" }
            examples:
              ejemplo:
                value:
                  nombre: "Merlu Cindy"
                  apellido: "Beyer Ulloa"
                  email: "ci.beyer@duocuc.cl"
                  fechaNacimiento: "2025-10-10"
                  genero: "mujer"
                  deporteFavorito: "68db058ff227b0dedcbcafec"
                  nivelExperiencia: "68db0d46f227b0dedcbcafff"
      responses:
        "201":
          description: Usuario guardado
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Usuario" }
              examples:
                ejemplo:
                  value:
                    _id: "oG2iP81bPadEch2c9mPiwejAsTr1"
                    nombre: "Merlu"
                    apellido: "Beyer Ulloa"
                    email: "ci.beyer@duocuc.cl"
                    fechaNacimiento: "2025-10-10"
                    genero: "mujer"
                    deporteFavorito: "68db058ff227b0dedcbcafec"
                    nivelExperiencia: "68db0d46f227b0dedcbcafff"
                    fechaRegistro: "2025-10-11T05:12:03.787Z"
                    rutas: []
                    eventos: []

  /users/{id}:
    get:
      tags: [usuarios]
      summary: Traer usuario por ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
          example: "oG2iP81bPadEch2c9mPiwejAsTr1"
      responses:
        "200":
          description: Usuario
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Usuario" }
              examples:
                ejemplo:
                  value:
                    _id: "oG2iP81bPadEch2c9mPiwejAsTr1"
                    nombre: "Merlu Cindy"
                    apellido: "Beyer Ulloa"
                    email: "ci.beyer@duocuc.cl"
                    fechaNacimiento: "2025-10-10"
                    genero: "mujer"
                    deporteFavorito: "68db058ff227b0dedcbcafec"
                    nivelExperiencia: "68db0d46f227b0dedcbcafff"
                    fechaRegistro: "2025-10-11T05:12:03.787Z"
                    rutas: []
                    eventos: ["68f1796608971e9b32658691"]
        "404":
          description: No encontrado

  # ------------------ DEPORTES ------------------
  /tipos-deporte:
    get:
      tags: [deportes]
      summary: Traer todos los deportes
      responses:
        "200":
          description: Lista de deportes
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Deporte" }
              examples:
                ejemplo:
                  value:
                    - _id: "68db058ff227b0dedcbcafec"
                      nombre: "Ciclismo"
                      icono: "bicycle"
                      color: "#22c55e"

  # ------------------ NIVELES ------------------
  /nivel-experiencia:
    get:
      tags: [niveles]
      summary: Traer todos los niveles de experiencia
      responses:
        "200":
          description: Lista de niveles
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Nivel" }
              examples:
                ejemplo:
                  value:
                    - _id: "68db0d46f227b0dedcbcafff"
                      nombre: "Principiante"
                      descripcion: "Comenzando en la disciplina"

  # ------------------ EVENTOS ------------------
  /eventos:
    get:
      tags: [eventos]
      summary: Traer todos los eventos
      description: Retorna todos los eventos (sin filtros).
      responses:
        "200":
          description: Lista de eventos
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Evento" }
              examples:
                ejemplo:
                  value:
                    - _id: "68f1796608971e9b32658691"
                      nombre_evento: "dd"
                      deporte_id: "68db058ff227b0dedcbcafec"
                      lugar: "d"
                      fecha_evento: "2025-10-22T23:01:00.000Z"
                      max_participantes: 2
                      descripcion: ""
                      createdBy: "iyo0GLHvlCaEjhhXBVZ1c1mLYZ63"
                      participantes: []
                      estado: "cancelado"
                      createdAt: "2025-10-16T23:01:57.552Z"
    post:
      tags: [eventos]
      summary: Guardar evento (crear)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/EventoCreateInput" }
            examples:
              ejemplo:
                value:
                  nombre_evento: "Corrida por los cachorros"
                  deporte_id: "68db058ff227b0dedcbcafec"
                  lugar: "costanera chiguayante"
                  fecha_evento: "2025-12-01T09:00:00.000Z"
                  max_participantes: 10
                  descripcion: "Corrida mirando un paisaje hermoso, ven a disfrutar."
                  createdBy: "ijN7goYrDtQ5MmeZl29TLPfVLRs2"
      responses:
        "201":
          description: Evento creado
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Evento" }
              examples:
                ejemplo:
                  value:
                    _id: "68f07e35cf083f75f825f949"
                    nombre_evento: "Corrida por los cachorros"
                    deporte_id: "68db058ff227b0dedcbcafec"
                    lugar: "costanera chiguayante"
                    fecha_evento: "2025-12-01T09:00:00.000Z"
                    max_participantes: 10
                    descripcion: "Corrida mirando un paisaje hermoso, ven a disfrutar."
                    createdBy: "ijN7goYrDtQ5MmeZl29TLPfVLRs2"
                    participantes: []
                    estado: "programado"
                    createdAt: "2025-10-22T22:29:53.382Z"

  /eventos/{id}:
    get:
      tags: [eventos]
      summary: Traer evento por ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
          example: "68f07e35cf083f75f825f949"
      responses:
        "200":
          description: Evento
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Evento" }
              examples:
                ejemplo:
                  value:
                    _id: "68f1796608971e9b32658691"
                    nombre_evento: "dd"
                    deporte_id: "68db058ff227b0dedcbcafec"
                    lugar: "d"
                    fecha_evento: "2025-10-22T23:01:00.000Z"
                    max_participantes: 2
                    descripcion: ""
                    createdBy: "iyo0GLHvlCaEjhhXBVZ1c1mLYZ63"
                    participantes: []
                    estado: "cancelado"
                    createdAt: "2025-10-16T23:01:57.552Z"
        "404":
          description: No encontrado

  /eventos/{id}/participar:
    post:
      tags: [eventos]
      summary: Participar en evento
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
          example: "68f07e35cf083f75f825f949"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ParticipacionInput" }
            examples:
              ejemplo:
                value:
                  uid: "oG2iP81bPadEch2c9mPiwejAsTr1"
      responses:
        "200":
          description: Participación registrada
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Evento" }
    delete:
      tags: [eventos]
      summary: Cancelar participación en evento
      description: Envía el UID del usuario que cancela su participación.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
          example: "68f07e35cf083f75f825f949"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ParticipacionInput" }
            examples:
              ejemplo:
                value:
                  uid: "oG2iP81bPadEch2c9mPiwejAsTr1"
      responses:
        "200":
          description: Participación cancelada
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Evento" }

components:
  schemas:
    # -------- Usuarios --------
    UsuarioCreateInput:
      type: object
      required:
        [
          nombre,
          apellido,
          email,
          fechaNacimiento,
          genero,
          deporteFavorito,
          nivelExperiencia,
        ]
      properties:
        nombre: { type: string, example: "Merlu Cindy" }
        apellido: { type: string, example: "Beyer Ulloa" }
        email: { type: string, format: email, example: "ci.beyer@duocuc.cl" }
        fechaNacimiento: { type: string, format: date, example: "2025-10-10" }
        genero: { type: string, example: "mujer" }
        deporteFavorito: { type: string, example: "68db058ff227b0dedcbcafec" }
        nivelExperiencia: { type: string, example: "68db0d46f227b0dedcbcafff" }

    Usuario:
      type: object
      properties:
        _id: { type: string, example: "oG2iP81bPadEch2c9mPiwejAsTr1" }
        nombre: { type: string, example: "Merlu Cindy" }
        apellido: { type: string, example: "Beyer Ulloa" }
        email: { type: string, format: email, example: "ci.beyer@duocuc.cl" }
        fechaNacimiento: { type: string, format: date, example: "2025-10-10" }
        genero: { type: string, example: "mujer" }
        deporteFavorito: { type: string, example: "68db058ff227b0dedcbcafec" }
        nivelExperiencia: { type: string, example: "68db0d46f227b0dedcbcafff" }
        fechaRegistro:
          {
            type: string,
            format: date-time,
            example: "2025-10-11T05:12:03.787Z",
          }
        rutas:
          type: array
          items: { type: string }
          example: []
        eventos:
          type: array
          items: { type: string }
          example: ["68f1796608971e9b32658691"]

    # -------- Deportes / Niveles --------
    Deporte:
      type: object
      properties:
        _id: { type: string, example: "68db058ff227b0dedcbcafec" }
        nombre: { type: string, example: "Ciclismo" }
        icono: { type: string, example: "bicycle" }
        color: { type: string, example: "#22c55e" }

    Nivel:
      type: object
      properties:
        _id: { type: string, example: "68db0d46f227b0dedcbcafff" }
        nombre: { type: string, example: "Principiante" }
        descripcion: { type: string, example: "Comenzando en la disciplina" }

    # -------- Eventos --------
    EventoCreateInput:
      type: object
      required:
        [
          nombre_evento,
          deporte_id,
          lugar,
          fecha_evento,
          max_participantes,
          createdBy,
        ]
      properties:
        nombre_evento: { type: string, example: "Corrida por los cachorros" }
        deporte_id: { type: string, example: "68db058ff227b0dedcbcafec" }
        lugar: { type: string, example: "costanera chiguayante" }
        fecha_evento:
          {
            type: string,
            format: date-time,
            example: "2025-12-01T09:00:00.000Z",
          }
        max_participantes: { type: integer, example: 10 }
        descripcion:
          {
            type: string,
            example: "Corrida mirando un paisaje hermoso, ven a disfrutar.",
          }
        createdBy: { type: string, example: "ijN7goYrDtQ5MmeZl29TLPfVLRs2" }

    ParticipacionInput:
      type: object
      required: [uid]
      properties:
        uid: { type: string, example: "oG2iP81bPadEch2c9mPiwejAsTr1" }

    Evento:
      type: object
      properties:
        _id: { type: string, example: "68f1796608971e9b32658691" }
        nombre_evento: { type: string, example: "dd" }
        deporte_id: { type: string, example: "68db058ff227b0dedcbcafec" }
        lugar: { type: string, example: "d" }
        fecha_evento:
          {
            type: string,
            format: date-time,
            example: "2025-10-22T23:01:00.000Z",
          }
        max_participantes: { type: integer, example: 2 }
        descripcion: { type: string, example: "" }
        createdBy: { type: string, example: "iyo0GLHvlCaEjhhXBVZ1c1mLYZ63" }
        participantes:
          type: array
          description: Lista de UIDs de participantes
          items: { type: string, example: "oG2iP81bPadEch2c9mPiwejAsTr1" }
          example: []
        estado:
          type: string
          enum: [programado, cancelado, finalizado]
          example: "cancelado"
        createdAt:
          {
            type: string,
            format: date-time,
            example: "2025-10-16T23:01:57.552Z",
          }
